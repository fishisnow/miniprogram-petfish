<view class="home-container">
  <nav pageType="home" activeTab="{{activeTab}}" bind:tabchange="onTabChange" />
  <view class="home-content">
    <t-pull-down-refresh
      value="{{enable}}"
      bind:refresh="onRefresh"
      loadingTexts="{{['下拉刷新', '松手刷新', '加载中...', '刷新完成']}}"
    >
      <scroll-view 
        scroll-y 
        style="height: calc(100vh - 200rpx); width: 100%;"
        bindscrolltolower="loadMoreData" 
        lower-threshold="200"
        enhanced="{{true}}"
        show-scrollbar="{{false}}"
      >
        <view wx:if="{{loading && !enable}}" class="home-loading-container">
          <t-loading theme="circular" size="60rpx" />
          <text class="loading-text">加载中...</text>
        </view>

        <view wx:elif="{{activeTab === 'recommend' && cardInfo.length > 0}}" class="home-card-list">
          <block wx:for="{{[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]}}" wx:key="*this" wx:if="{{index < cardInfo.length}}">
            <view class="card-wrapper {{index % 2 === 0 ? 'left' : 'right'}}">
              <card
                desc="{{cardInfo[index].desc}}"
                url="{{cardInfo[index].url}}"
                tags="{{cardInfo[index].tags}}"
                fish-id="{{cardInfo[index].fishId}}"
              />
            </view>
          </block>
        </view>
        
        <view wx:elif="{{activeTab === 'follow' && focusCardInfo.length > 0}}" class="home-card-list">
          <block wx:for="{{[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]}}" wx:key="*this" wx:if="{{index < focusCardInfo.length}}">
            <view class="card-wrapper {{index % 2 === 0 ? 'left' : 'right'}}">
              <card
                desc="{{focusCardInfo[index].desc}}"
                url="{{focusCardInfo[index].url}}"
                tags="{{focusCardInfo[index].tags}}"
                fish-id="{{focusCardInfo[index].fishId}}"
              />
            </view>
          </block>
        </view>
        
        <view wx:elif="{{!loading && !enable}}" class="home-empty-container">
          <text>暂无数据</text>
        </view>

        <view class="home-bottom-tip" wx:if="{{!loading && !enable && cardInfo.length > 0}}">
          <view wx:if="{{isLoadingMore}}" class="loading-more">
            <t-loading theme="circular" size="40rpx" />
            <text class="loading-text">加载中...</text>
          </view>
          <view wx:elif="{{activeTab === 'recommend' && hasMoreData && cardInfo.length > 0}}" bindtap="loadMoreData" class="load-more-btn">
            <view class="pull-up-icon">
              <view class="arrow"></view>
            </view>
            <text class="pull-up-text">上拉加载更多</text>
          </view>
          <view wx:elif="{{activeTab === 'follow' && popularHasMoreData && focusCardInfo.length > 0}}" bindtap="loadMoreData" class="load-more-btn">
            <view class="pull-up-icon">
              <view class="arrow"></view>
            </view>
            <text class="pull-up-text">上拉加载更多</text>
          </view>
          <text wx:elif="{{(activeTab === 'recommend' && cardInfo.length > 0) || (activeTab === 'follow' && focusCardInfo.length > 0)}}">到底部了，没有更多啦~</text>
        </view>
      </scroll-view>
    </t-pull-down-refresh>
  </view>
</view>

<t-message id="t-message" />