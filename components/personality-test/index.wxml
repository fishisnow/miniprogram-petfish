<!-- 测试题目卡片 -->
<view class="personality-test">
  <!-- 顶部导航与进度条区域 -->
  <view class="nav-area">
    <view class="back-button" bindtap="handleBack">
      <view class="back-icon"></view>
    </view>
    <view class="progress-bar">
      <view class="progress-inner" style="width: {{(currentQuestionIndex + 1) * 100 / questions.length}}%"></view>
    </view>
  </view>

  <!-- 测试内容区域 -->
  <view class="test-content">
    <swiper class="test-swiper" current="{{currentQuestionIndex}}" duration="300" bindchange="handleSwiperChange">
      <swiper-item wx:for="{{questions}}" wx:key="id">
        <view class="question-card">
          <view class="question-number">问题 {{index + 1}}/{{questions.length}}</view>
          <view class="question-title">{{item.title}}</view>
          <view class="options-list">
            <view 
              class="option-item {{selectedAnswers[index] === optionIndex ? 'selected' : ''}}" 
              wx:for="{{item.options}}" 
              wx:for-item="option"
              wx:for-index="optionIndex"
              wx:key="text"
              data-question-index="{{index}}"
              data-option-index="{{optionIndex}}"
              data-option="{{option}}"
              bindtap="handleOptionSelect"
            >
              <view class="option-content">
                <text>{{option.text}}</text>
                <view class="check-icon" wx:if="{{selectedAnswers[index] === optionIndex}}">✓</view>
              </view>
            </view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- 测试结果 -->
  <view class="test-result" wx:if="{{showResult}}">
    <view class="result-header">
      <view class="back-button" bindtap="handleBack">
        <view class="back-icon"></view>
      </view>
      <view class="result-title">六维养鱼性格测试</view>
    </view>
    
    <scroll-view scroll-y class="result-scroll">
      <view class="result-card" bindlongpress="saveResultImage">
        <view class="save-tip">长按保存图片</view>
        
        <view class="card-title">{{testResult.title || '六维养鱼性格测试结果'}}</view>
        
        <view class="result-description">{{testResult.description}}</view>
        
        <!-- 性格分析板块 -->
        <view class="analysis-section">
          <view class="section-title">性格分析</view>
          
          <!-- 修改为垂直排列布局，避免重叠 -->
          <view class="chart-container">
            <!-- 雷达图 -->
            <view class="radar-chart">
              <canvas wx:if="{{!radarImage}}" canvas-id="radarCanvas" style="width: 220px; height: 220px;"></canvas>
              <image wx:else src="{{radarImage}}" mode="widthFix" style="width: 220px; height: auto;"></image>
            </view>

            <!-- 维度评分条形图 - 只在页面上展示，保存图片时不使用 -->
            <view class="dimensions-chart">
              <view class="dimension-item" wx:for="{{radarDimensionNames}}" wx:key="index">
                <view class="dimension-info">
                  <text class="dimension-name">{{item}}</text>
                  <text class="dimension-score">{{radarScores[index]}}</text>
                </view>
                <view class="dimension-bar-bg">
                  <view class="dimension-bar" style="width: {{radarScores[index] * 100 / 20}}%;"></view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- 推荐鱼种 -->
        <view class="recommended-section">
          <view class="section-title">推荐鱼种</view>
          <view class="fish-list">
            <text wx:for="{{testResult.fishes}}" wx:key="*this" class="fish-item">{{item}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
    
    <!-- 结果页面用于生成分享图的隐藏画布 -->
    <canvas canvas-id="resultCanvas" class="result-canvas" style="width: 750px; height: 1600px; position: absolute; left: -9999px;"></canvas>
    
    <!-- 底部按钮区域 -->
    <view class="action-area">
      <button class="share-btn" open-type="share">
        <view class="share-icon"></view>
        分享结果
      </button>
      <button class="restart-btn" bindtap="restartTest">重新测试</button>
    </view>
  </view>
</view> 